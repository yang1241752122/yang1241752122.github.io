/* recharge.index.js Date:2016-02-02 17:29:27 */
$(function(){var a="";var b="";var c=$.Recharge.flowRecharge,d=$(".flow"),e=$("#flowphone"),f=$("#flowprice"),g=$(".ptime"),h={mobile:""},j=(document.rechargePhone,/^1[3-9]\d{9}$/),k=!1,l={defaultmsg:$("#flowMobileInfo"),osubmit:d.find(".button"),loadingIcon:d.find(".icon-loading")},m={50:"\uffe57.5-\uffe510.0",100:"\uffe59.95-\uffe520.0",200:"\uffe519.9-\uffe520.5",300:"\uffe529.0-\uffe529.9",500:"\uffe549.0-\uffe550.0"},n={country:"\u5168\u56fd",province:"\u7701\u5185"},o={v1:"\u53f7\u7801\u4e0d\u6b63\u786e",v2:"\u8bf7\u8f93\u5165\u624b\u673a\u53f7",v3:"\u672a\u77e5\u5730\u533a\u548c\u8fd0\u8425\u5546",noSku:"\u3010\u6682\u65e0\u3011",supportMsg:"\u79fb\u52a8\u3001\u8054\u901a\u3001\u7535\u4fe1",jdtongxin:"\u4eac\u4e1c\u901a\u4fe1"};var p=$("#areaSelect");var q=$("#faceSelect");e.bind("paste",function(){setTimeout(function(){r()},100)}).keyup(function(){11==e.val().length?r():(d.find(".icon-right").hide(),l.loadingIcon.hide(),l.defaultmsg.html(""),v(),a=e.val())}).blur(function(){$(this).val()?11==e.val().length&&r():$(this).val(o.v2).css("color","#999")}).focus(function(){var a=$(this).val();a&&a!=o.supportMsg&&a!=o.v2||$(this).val("").css("color","black")});function r(){var b=e.val();if(b!=a){if(!E(b))return e.val(b.replace(/\D/g,"")),l.defaultmsg.html(o.v1).addClass("msg-error"),l.osubmit.attr("disabled","false"),l.loadingIcon.hide(),d.find(".icon-right").hide(),v(),a=b,!1;l.loadingIcon.show(),c.loadIspArea(b,s),l.osubmit.removeAttr("disabled"),a=b}}function s(a){if(!a)return l.defaultmsg.html(o.v3).addClass("msg-error"),l.osubmit.attr("disabled","false").addClass("btn-nostore"),void l.loadingIcon.hide();var b=a.areaCode,e=a.mutCode,f=a.areaName+a.mutName;a.mutName==o.jdtongxin&&(f=o.jdtongxin),d.find(".icon-right").show(),l.defaultmsg.html(f).removeClass("msg-error"),c.loadSku(b,e,t)}function t(a){var b=areaStr="";return 0==a.country.length&&0==a.province.length?(f.html(o.noSku),l.osubmit.attr("disabled","false").addClass("btn-nostore"),k=!0,void v()):(p[0].options.length=0,q[0].options.length=0,l.osubmit.removeClass("btn-nostore"),l.osubmit.removeAttr("disabled"),areaStr=areaStr+x("country",a).areaStr+x("province",a).areaStr,b=b+x("country",a).faceStr+x("province",a).faceStr,q.html(b),p.html(areaStr),c.datasrc.defaultData=a,void $(p).trigger("change"))}var u={area:["\u5168\u56fd","\u7701\u5185"],face:[50,100,200,300,500]};function v(){w(p[0],u.area,"area"),w(q[0],u.face,"face"),q.trigger("change")}function w(a,b,c){if(a.options.length=0,"face"==c)for(var d=0;d<b.length;d++)a.options.add(new Option(b[d]+"M",b[d]));else if("area"==c)for(var d=0;d<b.length;d++)a.options.add(new Option(b[d],b[d]))}function x(a,b){var c=b[a],d=faceStr="";return 0!=c.length&&(d+=y(a),faceStr+=z(c,a)),{areaStr:d,faceStr:faceStr}}function y(a){var b="<option value='"+a+"' data-type='"+a+"'>"+n[a]+"</option>";return b}function z(a,b){var d=[];for(var e=0;e<a.length;e++){var f=a[e],g="<option data-type='"+b+"' data-skuId='"+f.skuId+"' value="+f.faceAmount+">"+A(f.faceAmount)+"</option>";d.push(g),c.datasrc[f.skuId]=f}return d.join("")}function A(a){var b=a%1024;return 0==b?a/1024+"G":a+"M"}function B(){var a=p[0].options[p[0].selectedIndex];var d=(q.find("option"),$(a).data("type")),e=q.find("option[data-type='"+d+"']");d&&c.datasrc.defaultData&&(q.empty(),faceStr=x(d,c.datasrc.defaultData).faceStr,q.html(faceStr),e.length>0&&$(e[0]).attr("selected","selected"),$(q).trigger("change"))}function C(){var a=q[0].options[q[0].selectedIndex];var b=c.datasrc[$(a).data("skuid")];if(b){var d=b.salePrice;d.indexOf(".")<0&&(d+=".0"),f.html("\uffe5"+d),h.skuId=b.skuId,h.areaUsed=b.areaUsed,h.faceAmount=q.val(),h.mobile=e.val(),g.html("("+b.time+")")}else{if(g.html(""),k)return void f.html(o.noSku);f.html(m[$(this).val()])}}function D(){h.mobile=e.val();{var a=h.skuId,b=h.mobile;h.faceAmount,h.areaUsed}return E(b)?E(b)&&a?(h.source=5,void c.submitOrder(h)):!1:(e.val(b.replace(/\D/g,"")),l.defaultmsg.html(o.v2).addClass("msg-error"),l.osubmit.attr("disabled","false"),e.focus(),!1)}function E(a){return a&&11==a.length?j.test(a):!1}p.live("change",B),q.live("change",C),l.osubmit.bind("click",D),$("#flowprice").html(m[50]);var F={10:"\uffe59.8-\uffe511.0",20:"\uffe519.6-\uffe521.0",30:"\uffe529.4-\uffe531.0",50:"\uffe549.0-\uffe550.0",100:"\uffe598.0-\uffe5100.0",200:"\uffe5196.0-\uffe5200.0",300:"\uffe5294.0-\uffe5300.0",500:"\uffe5490.0-\uffe5500.0"};var G=$("#rechargeNum"),H=G.parent(),I=H.find(".msg-wrap span"),J=G.find("s"),K=$("#priceRecharge"),L=[],M=null,N=$("#select-price-money"),O=$("#btnRecharge"),P=$("#phoneNumber"),Q=O.find(".btn-submit"),R=O.find(".btn-nostore");P.keyup(function(){if(11==P.val().length)S();else{b=P.val(),G.find(".icon-loading").hide(),I.html(""),J.hide();var a=N.val();F[a]&&T(a)}}).bind("paste",function(){setTimeout(function(){S()},100)}).focus(function(){var a=$(this).val();a&&a!=o.supportMsg&&a!=o.v2||$(this).val("").css("color","black")}).blur(function(){$(this).val()?11==P.val().length&&S():$(this).val(o.v2).css("color","#999")});function S(){var a=P.val();a!=b&&(E(a)?(J.hide(),G.find(".icon-loading").show(),$.Recharge.loadIspArea(a,U),b=a):(P.val(a.replace(/\D/g,"")),L[0]&&(L=[],M=N.val(),F[M]&&T(M)),W(),J.hide(),I.html(o.v1).addClass("msg-error"),Q.attr("disabled","disabled"),Y(!0),b=a))}T(N.val()),N.change(function(){var a=$(this).val();L[0]&&"undefined"!=typeof L[0].provider?$.Recharge.loadSkuData({faceValue:a,ISP:L[0].provider,area:L[0].area,filltype:0},V):F[a]&&T(a)});function T(a){F[a]?K.html(F[a]):(K.html("\u6682\u65e0"),Y())}function U(a){var b;L[0]=a,a.providerName?(J.hide(),G.find(".icon-right").show(),I.html(a.areaName+a.providerName).removeClass("msg-error"),b=a.provider+"@0",$.Recharge.loadHiddenPrice(b,W),$.Recharge.loadSkuData({faceValue:N.val(),ISP:a.provider,area:a.area,filltype:0},V)):(J.hide(),I.html(o.v3).addClass("msg-error"),Y())}function V(a){if(L[1]=a,a&&a.skuId){var b=a.frontJdPrice;parseInt(b)==b&&(b=parseInt(b)+".0"),K.html("\uffe5"+b),Q.removeAttr("disabled")}else K.html("\u6682\u65e0");Y()}function W(a){var b=null;if(b=N.find("option"),a){b.show();for(var c=0,d=a.length;d>c;c++)b.each(function(b){$(this).val()===a[b]&&($(this).is(":selected")&&(N.val($(this).next().eq(0).val()),N.trigger("select")),$(this).hide())})}else b.show()}O.delegate(".btn-submit","click",function(){var b=P.val();return E(b)?void(L[0]&&L[1]&&"undefined"!=typeof L[0].provider&&L[1].skuId&&X()):(P.val(b.replace(/\D/g,"")),P.focus(),I.html(o.v2).addClass("msg-error"),Q.removeAttr("disabled"),!1)});function X(){window.location.host;window.open("/order/order_place.action?skuId="+L[1].skuId+"&mobile="+P.val()+"&entry=1")}function Y(a){a=a?a:!1,L[0]&&L[1]&&"undefined"!=typeof L[0].provider&&L[1].skuId||a?(R.hide(),Q.show()):(R.show(),Q.hide())}});
